(self.webpackChunkslot_machine=self.webpackChunkslot_machine||[]).push([[870],{4237:(e,t,n)=>{e.exports=n.p+"assets/user-placeholder.jpg"},4870:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var r,a,b=n(4848),m=n(6540),w=n(5054),x=n(3175),j=n(1083),t=n(8803),o=(r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});function c(){return null!==a&&a.apply(this,arguments)||this}a=t.A,o(c,a);let _=new c,s=n(3443);var i=n(2433),u=n(961),l=n(1987),A=n(59),p=function(e,c,s,i){return new(s=s||Promise)(function(n,t){function r(e){try{o(i.next(e))}catch(e){t(e)}}function a(e){try{o(i.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,a)}o((i=i.apply(e,c||[])).next())})},f=function(r,a){var o,c,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=e(0),u.throw=e(1),u.return=e(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(n){return function(e){var t=[n,e];if(o)throw new TypeError("Generator is already executing.");for(;i=u&&t[u=0]?0:i;)try{if(o=1,c&&(s=2&t[0]?c.return:t[0]?c.throw||((s=c.return)&&s.call(c),0):c.next)&&!(s=s.call(c,t[1])).done)return s;switch(c=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return i.label++,{value:t[1],done:!1};case 5:i.label++,c=t[1],t=[0];continue;case 7:t=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){i=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))i.label=t[1];else if(6===t[0]&&i.label<s[1])i.label=s[1],s=t;else{if(!(s&&i.label<s[2])){s[2]&&i.ops.pop(),i.trys.pop();continue}i.label=s[2],i.ops.push(t)}}t=a.call(r,i)}catch(e){t=[6,e],c=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}};let S=(0,m.memo)((0,s.PA)(function(){var e=(0,m.useState)(!1),t=e[0],c=e[1],s=["jpg","jpeg","png","webp"];function n(e){e.preventDefault(),c(!0)}function r(e){e.preventDefault(),c(!1)}function a(o){return p(this,void 0,void 0,function(){var n,r,a;return f(this,function(e){switch(e.label){case 0:n=function(t){return new Promise(function(n,r){var e=new FileReader;e.onload=function(e){var t=new Image;t.src=null==(e=e.target)?void 0:e.result,t.onload=function(){if(t.width%t.height!=0)return r(new Error("Файл должен быть квадратным, желательно разрешения 256x256"));n()}},e.readAsDataURL(t)})},o.preventDefault(),e.label=1;case 1:if(e.trys.push([1,4,,5]),r=void 0,1<(r="dataTransfer"in o?Array.from(o.dataTransfer.files):o.target.files).length)throw new Error("Можно загрузить только один файл");if(r=r[0],a=r.name.split(".").pop().toLowerCase(),s.includes(a))return[4,n(r)];throw new Error("Файл должен быть одним из форматов ".concat(s));case 2:return e.sent(),[4,(t=r,l.A.post("".concat(A.URL_SERVER_API,"uploadAvatar"),{avatar:t},{headers:{"Content-Type":"multipart/form-data"}}),c(!1),void _.close())];case 3:return e.sent(),[3,5];case 4:return a=e.sent(),document.getElementsByClassName("base-avatar")[0].querySelector("p").textContent="Ошибка: ".concat(a.message),[3,5];case 5:return[2]}var t})})}return _.isOpen?u.createPortal((0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.A,{setModal:function(){return _.close()}}),t?(0,b.jsxs)("div",{onDragStart:n,onDragLeave:r,onDragOver:n,onDrop:function(e){return a(e)},className:"drop-avatar base-avatar",children:[(0,b.jsx)("p",{children:"Отпустите файлы чтобы их загрузить"}),(0,b.jsx)("input",{type:"file",onChange:function(e){return a(e)}})]}):(0,b.jsxs)("div",{onDragStart:n,onDragLeave:r,onDragOver:n,className:"base-avatar",children:[(0,b.jsx)("p",{children:"Перетащите файл, чтобы его загрузить, аватарка должна быть квадратной, желательно 256x256"}),(0,b.jsx)("input",{type:"file",onChange:function(e){return a(e)}})]})]}),document.body):null}));var E=n(1712),O=n(7813),N=n(4237),R=n(7166),k=n(5499),I=function(e,c,s,i){return new(s=s||Promise)(function(n,t){function r(e){try{o(i.next(e))}catch(e){t(e)}}function a(e){try{o(i.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,a)}o((i=i.apply(e,c||[])).next())})},P=function(r,a){var o,c,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=e(0),u.throw=e(1),u.return=e(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(n){return function(e){var t=[n,e];if(o)throw new TypeError("Generator is already executing.");for(;i=u&&t[u=0]?0:i;)try{if(o=1,c&&(s=2&t[0]?c.return:t[0]?c.throw||((s=c.return)&&s.call(c),0):c.next)&&!(s=s.call(c,t[1])).done)return s;switch(c=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return i.label++,{value:t[1],done:!1};case 5:i.label++,c=t[1],t=[0];continue;case 7:t=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){i=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))i.label=t[1];else if(6===t[0]&&i.label<s[1])i.label=s[1],s=t;else{if(!(s&&i.label<s[2])){s[2]&&i.ops.pop(),i.trys.pop();continue}i.label=s[2],i.ops.push(t)}}t=a.call(r,i)}catch(e){t=[6,e],c=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}};let h=(0,m.memo)((0,s.PA)(function(){var e=(v=(0,m.useState)(!1))[0],r=v[1],t=(v=(0,m.useState)(null))[0],a=v[1],n=(v=(0,m.useState)(null))[0],o=v[1],c=(v=(0,m.useState)(-1))[0],s=v[1],i=(0,x.g)().nickname,u=(v=(0,R.A)())[0],l=v[1],p=(v=(0,k.A)())[0],f=v[1];if((0,m.useEffect)(function(){f(function(){return function(){return I(this,void 0,void 0,function(){var t,n;return P(this,function(e){switch(e.label){case 0:return[4,j.A.get("".concat(A.URL_SERVER_API,"users?nickname=").concat(i))];case 1:return t=e.sent().data[0],[4,w.A.getByUser(t.id)];case 2:return e.sent(),a(t),n=o,[4,w.A.relationParse()];case 3:return n.apply(void 0,[e.sent()]),r(!0),[2]}})})}()})},[i]),p)throw new Error("Ошибка: Пользователя не существует");function h(e){return(0,b.jsx)("ol",{children:n[e].map(function(n,e){return(0,b.jsxs)("li",{className:"game",children:[(0,b.jsx)(x.N_,{to:"/games/".concat(n.game),children:(0,b.jsx)("img",{src:n.capsule_image,className:"image-game"})}),(0,b.jsxs)("span",{className:"head-inside",children:[(0,b.jsx)(x.N_,{to:"/games/".concat(n.game),children:(0,b.jsx)("span",{children:n.name})}),(0,b.jsx)("span",{onMouseEnter:function(){return l(function(){return s(n.id)},!1)},onFocus:function(){return s(n.id)},onBlur:function(){return s(-1)},children:c==n.id?(0,b.jsx)("input",{type:"number",onChange:function(e){var t;e.target.value=(t=e.target.value,10<(t=Number(t))?"10":t<1?"0":String(t)),w.A.gradeChange(e.target.value,n.id,n.user_id),n.grade="0"==e.target.value?"Нет оценки":e.target.value}}):n.grade||"Нет оценки"}),(0,b.jsx)("span",{children:n.gradeSite||"Нет отзывов"}),(0,b.jsx)("span",{children:n.rating})]})]},e)})})}function d(){return!!g&&y&&g.nickname==i}var v=(0,b.jsxs)("span",{className:"head-section",children:[(0,b.jsx)("span",{children:"Название"}),(0,b.jsx)("span",{children:"Оценка"}),(0,b.jsx)("span",{children:"Рейтинг на Igropoisk"}),(0,b.jsx)("span",{children:"Рейтинг STEAM"})]}),y=(0,m.useContext)(E.o),g=(0,O.HO)((0,m.useContext)(E.o)).user;if(e)return(0,b.jsxs)(b.Fragment,{children:[u,(0,b.jsx)(S,{}),(0,b.jsxs)("main",{className:"profile-main",children:[(0,b.jsxs)("div",{className:"about-user",children:[(0,b.jsx)("img",{onError:function(e){return e.currentTarget.src=N},className:"avatar-large",src:"".concat(A.URL_SERVER_AVATARS).concat(t.avatar)}),d()&&(0,b.jsx)("button",{className:"button-stand br-n",onClick:function(){return l(function(){return _.open()})},children:"Загрузить аватурку"}),d()&&(0,b.jsx)("button",{className:"button-stand br-n",onClick:function(){return l(function(){return y.logout()})},children:"Выйти"}),(0,b.jsx)("h1",{children:i}),(0,b.jsx)("p",{children:"На сайте с ".concat(t.created_at,", Комментариев: ").concat(t.comments_count,", Отзывов: ").concat(t.grade_count)}),(0,b.jsxs)("div",{children:["Запланировано: ",n.planned.length," / Играю: ",n.play.length," / Пройдено: ",n.passed.length," / Брошено: ",n.dropped.length," "]})]}),(0,b.jsx)("p",{className:"border-dashed",children:"Запланировано"}),v,h("planned"),(0,b.jsx)("p",{className:"border-dashed",children:"Играю"}),v,h("play"),(0,b.jsx)("p",{className:"border-dashed",children:"Пройдено"}),v,h("passed"),(0,b.jsx)("p",{className:"border-dashed",children:"Брошено"}),v,h("dropped")]})]});(0,b.jsx)("div",{children:"Загрузка"})}))},4877:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(4848),o=n(3175),c=n(7555),t=n(3443),s=n(961),i=n(6540);let r=(0,i.memo)((0,t.PA)(function(e){var t=e.children,n=e.link,r=e.time,e=e.color;return(0,i.useEffect)(function(){var e=setTimeout(function(){c.A.close()},r+50);return function(){return clearTimeout(e)}},[r,c.A.isOpen]),c.A.isOpen?s.createPortal((0,a.jsx)(o.N_,{to:n,className:"snackbar",style:{animation:"fadeInOut 0.2s ease-in-out, ending 0.2s linear ".concat(r/1e3-.2,"s forwards"),backgroundColor:e||""},children:t}),document.body):null}))},5054:(e,t,n)=>{n.d(t,{A:()=>l});var s=n(7813),i=n(1083),a=n(1987),o=n(59),c=function(e,c,s,i){return new(s=s||Promise)(function(n,t){function r(e){try{o(i.next(e))}catch(e){t(e)}}function a(e){try{o(i.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,a)}o((i=i.apply(e,c||[])).next())})},u=function(r,a){var o,c,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=e(0),u.throw=e(1),u.return=e(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(n){return function(e){var t=[n,e];if(o)throw new TypeError("Generator is already executing.");for(;i=u&&t[u=0]?0:i;)try{if(o=1,c&&(s=2&t[0]?c.return:t[0]?c.throw||((s=c.return)&&s.call(c),0):c.next)&&!(s=s.call(c,t[1])).done)return s;switch(c=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return i.label++,{value:t[1],done:!1};case 5:i.label++,c=t[1],t=[0];continue;case 7:t=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){i=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))i.label=t[1];else if(6===t[0]&&i.label<s[1])i.label=s[1],s=t;else{if(!(s&&i.label<s[2])){s[2]&&i.ops.pop(),i.trys.pop();continue}i.label=s[2],i.ops.push(t)}}t=a.call(r,i)}catch(e){t=[6,e],c=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}};function r(){(this.relation=null,s.l_)(this)}r.prototype.getByUser=function(r,a){return c(this,void 0,void 0,function(){var t,n;return u(this,function(e){switch(e.label){case 0:return t=a||"",n=this,[4,i.A.get("".concat(o.URL_SERVER_API,"relations/").concat(r,"?game=").concat(t))];case 1:return n.relation=e.sent().data,[2]}})})},r.prototype.post=function(t){return c(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return[4,a.A.post("http://localhost:3000/api/relations/",t)];case 1:return e.sent(),[4,this.getByUser(String(t.user_id))];case 2:return e.sent(),[2]}})})},r.prototype.grade=function(n){return c(this,void 0,void 0,function(){var t;return u(this,function(e){switch(e.label){case 0:return[4,fetch("".concat(o.URL_SERVER_API,"grades?game=").concat(n))];case 1:return t=e.sent(),[2,t.json()]}})})},r.prototype.gradeChange=function(t,n,r){return c(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return 0==t?t=null:Number(t),[4,a.A.put("".concat(o.URL_SERVER_API,"relations/").concat(n),{grade:t,user_id:r})];case 1:return e.sent(),[2]}})})},r.prototype.relationGame=function(t,n){return c(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return[4,fetch("".concat(o.URL_SERVER_API,"relations/").concat(t,"?game=").concat(n))];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}})})},r.prototype.relationParse=function(){return c(this,void 0,void 0,function(){var t,n,r,a,o,c;return u(this,function(e){switch(e.label){case 0:t={planned:[],dropped:[],play:[],passed:[]},r=(n=0,s.HO)(this.relation),e.label=1;case 1:return n<r.length?(a=r[n],[4,i.A.get("http://localhost:3000/api/gameDB/".concat(a.game))]):[3,5];case 2:return o=e.sent().data,[4,i.A.get("http://localhost:3000/api/grades?game=".concat(a.game))];case 3:c=e.sent().data[0].grade,a.name=o.name,a.capsule_image=o.capsule_image,a.total_reviews=o.total_reviews,a.rating=(100-o.total_negative/o.total_reviews*100).toFixed(2),a.grade=a.grade,a.gradeSite=c,"planned"==a.status&&t.planned.push(a),"dropped"==a.status&&t.dropped.push(a),"play"==a.status&&t.play.push(a),"passed"==a.status&&t.passed.push(a),e.label=4;case 4:return n++,[3,1];case 5:return[2,t]}})})};let l=new r},5499:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(6540),o=function(e,c,s,i){return new(s=s||Promise)(function(n,t){function r(e){try{o(i.next(e))}catch(e){t(e)}}function a(e){try{o(i.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,a)}o((i=i.apply(e,c||[])).next())})},c=function(r,a){var o,c,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=e(0),u.throw=e(1),u.return=e(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(n){return function(e){var t=[n,e];if(o)throw new TypeError("Generator is already executing.");for(;i=u&&t[u=0]?0:i;)try{if(o=1,c&&(s=2&t[0]?c.return:t[0]?c.throw||((s=c.return)&&s.call(c),0):c.next)&&!(s=s.call(c,t[1])).done)return s;switch(c=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return i.label++,{value:t[1],done:!1};case 5:i.label++,c=t[1],t=[0];continue;case 7:t=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){i=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))i.label=t[1];else if(6===t[0]&&i.label<s[1])i.label=s[1],s=t;else{if(!(s&&i.label<s[2])){s[2]&&i.ops.pop(),i.trys.pop();continue}i.label=s[2],i.ops.push(t)}}t=a.call(r,i)}catch(e){t=[6,e],c=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}};let r=function(){var e=this,t=(0,a.useState)(!1),n=t[0],r=t[1];return[n,function(t){return o(e,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,t()];case 1:return[2,e.sent()];case 2:return e.sent(),[2,r(!0)];case 3:return[2]}})})}]}},7166:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(4848),o=n(7555),c=n(4877),s=n(6540),i=n(1712);let a=function(){try{var e=localStorage.getItem("accessToken");0<1e3*JSON.parse(atob(e.split(".")[1])).exp-Date.now()&&0}catch(e){0}var a=(0,s.useContext)(i.o);return[(0,r.jsx)(c.A,{link:"/login",time:5e3,children:localStorage.getItem("accessToken")?"Время ожидания вышло, повторите действие, или повторно авторизируйтесь":"Для этого действия необходима авторизация"}),function(e,t){void 0===t&&(t=!0);try{var n=localStorage.getItem("accessToken"),r=JSON.parse(atob(n.split(".")[1]));if(0<1e3*r.exp-Date.now())return e();throw a.refreshAccessToken(),new Error("ACCESS TOKEN ПРОСРОЧИЛСЯ 401")}catch(e){return t?o.A.open():""}}]}},7555:(e,t,n)=>{n.d(t,{A:()=>c});var r,a,t=n(8803),n=(r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});function o(){return null!==a&&a.apply(this,arguments)||this}a=t.A,n(o,a);let c=new o},8803:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(7813);function a(){(this.isOpen=!1,r.Gn)(this,{isOpen:r.sH,open:r.XI,close:r.XI})}a.prototype.open=function(){this.isOpen=!0},a.prototype.close=function(){this.isOpen=!1};let o=a}}]);